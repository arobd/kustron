# build step
FROM maven:3.5.2-jdk-8-alpine AS builder

RUN mkdir -p /build
WORKDIR /build
COPY .m2 /build/.m2
COPY pom.xml /build
COPY src /build/src
ENV MAVEN_OPTS="-Dmaven.repo.local=/build/.m2/repository"
RUN mvn package

# package image step
FROM openjdk:8-jre-alpine AS runtime
EXPOSE {{app.port}}

# set app home folder
ENV APP_HOME /{{app.name}}

RUN mkdir -p $APP_HOME
WORKDIR $APP_HOME
COPY --from=builder /build/target/*.jar {{app.name}}.jar
ENTRYPOINT ["java", "-jar", "{{app.name}}.jar"]
